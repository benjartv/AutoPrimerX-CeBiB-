<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <ui:composition template="/template.xhtml">
        <ui:define name="title">
            <h:outputText value="Microorganismos"></h:outputText>
        </ui:define>
        <h:head>

            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous"/>
        </h:head>
        <ui:define name="body">
            <h:outputScript>
                //<![CDATA[ 
                function disableprob() {
                $("#codonUsageBtn").addClass("disabled");
                }

                function enableprob() {
                    console.log("Entra en el enableprob");
                    $("#codonUsageBtn").removeClass("disabled");
                    var links = document.getElementsByClassName("link-seq");
                    for(i = 0; i < links.length; i++){
                        links[i].onclick = function(){
                            console.log(links[i]);
                            getNucleotideSeq(links[i]);
                        };
                    }
                }
                
                //]]>
            </h:outputScript>
            <h:body>
                <p:dialog id="modalayuda" header="Ayuda con archivo de BLAST" widgetVar="dlg3" showEffect="fade" modal="true" hideEffect="fade" height="520" width="1250">
                    <h3>PASO 1:</h3>
                    <h:outputText value="En primera instancia debe ingresar a la página oficila de la NCBI, " />
                    <p:button target="_blank" href="http://blast.ncbi.nlm.nih.gov/Blast.cgi" value="BLAST" />
                    
                        <div class="row">
                            <div class="col col-md-5">
                                <h:graphicImage  class="bl1"  value="/resources/images/blast1.JPG" />    
                            </div>
                            <div class="col col-md-7">
                                <p id="parrafo">Una vez en la página se debe ir a la sección de <strong>Basic BLAST</strong> y seleccionar "protein blast"</p>
                            </div>
                        </div>
                        <h3>PASO 2:</h3>
                        <div class="row">
                            <div class="col col-md-7">
                                <h:graphicImage  class="bl1"  value="/resources/images/blast2.JPG" />    
                            </div>
                            <div class="col col-md-5">
                                <p>Ingresar el nombre de la proteína o su secuencia. Luego parametrizar BLAST a su preferencia.</p>
                                <p>Una vez finaizado el proceso, presionar el boton que se aprecia en la siguiente figura:</p>
                                <h:graphicImage value="/resources/images/btnblast.JPG" />    
                                <p>Esperar resultados...</p>
                            </div>
                        </div>
                        <br/><br/>
                        <h3>PASO 3:</h3>
                        <div class="row">
                            <div class="col col-md-7">
                                <h:graphicImage  class="bl1"  value="/resources/images/blast3.JPG" />    
                            </div>
                            <div class="col col-md-5">
                                <p>Una vez tengamos los resultados, descender hasta "Descriptions" y presionar el link "All", esto para que ingresen todas las proteinas al archivo.</p>
                                <p>Luego, en el menu desplegable "Download", seleccionar "FASTA (complete sequence)" y presionar el boton continuar.</p>
                                <p>Finalmente, obtendrá un archivo como el que se muestra en la siguiente imagen:</p>
                                <h:graphicImage value="/resources/images/blast4.JPG" />
                                <p>Que es el archivo de secuencias homólogas.</p>
                            </div>
                        </div>
                    


                </p:dialog>
                <h:form id="probab-form" enctype="multipart/form-data" prependId="false">
                    <p:commandButton action="#{primerG3.submitprob(codonUsageController.selected)}" id="codonUsageBtn" immediate="true" ajax="true"  icon="ui-icon-pencil" value="Elegir Probabilidades del Uso de Codon" update=":CodonUsageProbForm" oncomplete="PF('CodonUsageProbDlg').show()" disabled="#{empty codonUsageController.selected}"/>     
                </h:form>
                <div>
                    <h:form enctype="multipart/form-data" prependId="false">
                        <h:panelGrid columns="1" cellpadding="5">
                            <p:commandButton id="ayudabtn" value="¿Como obtengo el archivo de secuencias homologas?" type="button" onclick="PF('dlg3').show();" /> 
                        </h:panelGrid>
                        <p:messages autoUpdate="true"/>
                        <p:growl  showDetail="true" sticky="true" /> 
                        <p:panel id="pnl" styleClass="no-border">
                            <div class="row form-group">
                                <h1 class="col-md-offset-1">Microorganismos</h1>
                                <div class="col-md-4 col-md-offset-1">

                                    <p:outputLabel styleClass="form-label" value="Seleccione un organismo (si las probabilidades aparecen en 0, vuelva a seleccionar)" for="usodecodon" /> 
                                    <div>
                                        <p:selectOneMenu id="usodecodon" value="#{codonUsageController.selected}" required="true" requiredMessage="Es necesario seleccionar un uso de condon" panelStyle="width:180px" 
                                                         effect="fade" style="width:160px" filter="true" filterMatchMode="startsWith"  >
                                            <f:selectItem itemLabel="Ninguno" noSelectionOption="true" itemDisabled="true"/>
                                            <f:selectItems value="#{codonUsageController.itemsAvailableSelectOne}"
                                                           var="pacienteItem"
                                                           itemValue="#{codonUsageItem}"/>
                                            <p:ajax event="change" listener="#{primerG3.cambiarUsoCodon(codonUsageController.selected)}" update=":probab-form:codonUsageBtn"/>

                                        </p:selectOneMenu>
                                    </div>
                                    <div>
                                        <p:button outcome="/codonUsage/List" value="Agregar Organismo" icon="ui-icon-plus" ></p:button>
                                    </div>    

                                    <p:outputLabel styleClass="form-label" value="Ingrese el archivo de secuencias homologas" for="input-file"/>
                                    <p:fileUpload id="input-file" value="#{primerG3.file}" mode="simple" required="true" requiredMessage="Debe seleccionar un archivo"/>

                                    <p:outputLabel styleClass="form-label" value="Ingrese la tolerancia para aminoácidos conservados" for="conservado" /> 
                                    <p:inputText type="number" id="conservado" value="#{primerG3.conservado}" required="true" requiredMessage="Debe ingresar la tolerancia para aminoácidos conservados" />                                   
                                    
                                    <p:outputLabel styleClass="form-label" value="Ingrese la tolerancia para aminoácidos idénticos" for="identico" />
                                    <p:inputText type="number" id="identico" value="#{primerG3.identico}" required="true" requiredMessage="Debe ingresar la tolerancia para aminoácidos idénticos" />
                                    <br/>

                                    <p:outputLabel styleClass="form-label" value="Ingrese el tamaño de la región conservada" for="tamanoPrimer" />
                                    <p:inputText type="number" id="tamanoPrimer" value="#{primerG3.tamanoPrimer}" required="true" requiredMessage="Debe ingresar el tamaño de la región conservada"/>

                                    <br/>
                                    <br/>
                                    <div class="row">
                                        <div id="errorMsge" class="col-md-12 alert alert-danger hidden" role="alert">
                                            <p>
                                                La tolerancia para aminoácidos conservados debe ser mayor que la tolerancia para aminoácidos idénticos
                                            </p>
                                        </div>
                                        <div class="col-md-offset-7">
                                            <p:remoteCommand name="updateprob" update=":probab-form:codonUsageBtn" />
                                            <p:commandButton id="clean" value="Limpiar" actionListener="#{primerG3.cleanAnswer()}" update="nucleotidos alineados" ajax="false" />
                                            <p:commandButton id="submit" value="Envíar" update="nucleotidos" actionListener="#{primerG3.submit(codonUsageController.selected)}" ajax="false" onclick="PF('block').show();
                                                    disableprob();" oncomplete="PF('block').hide();enableprob();" />                                                                                
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-7" >
                                    <p:outputLabel styleClass="form-label" value="Sitios conservados" />
                                    <hr/>
                                    <!--div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                                        <span class="hidden">#{count = 0}</span>
                                        <ui:repeat value="#{primerG3.consensos}" var="seq">
                                            <div class="panel panel-default">
                                                <div class="panel-heading" role="tab" id="heading#{count}">
                                                    <h5 class="panel-title">
                                                        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse#{count}" aria-expanded="false" aria-controls="collapse#{count}">
                                                            <span class="link-seq" id="link#{count}">
                                                                #{seq}
                                                            </span>
                                                        </a>
                                                    </h5>
                                                </div>
                                                <div id="collapse#{count}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading#{count}">
                                                    <div class="panel-body" id="body#{count}">
                                                    </div>
                                                </div>
                                            </div>
                                            <span class="hidden">#{count = count + 1}</span>
                                        </ui:repeat>
                                    </div-->
                                    <span class="hidden">#{i = 0}</span>
                                    <p:accordionPanel styleClass="sitios-conservados" multiple="true" value="#{primerG3.consensos}" var="seq">
                                        <p:tab title="#{primerG3.nucleotidSequence(seq)}">
                                            <span class="hidden">#{j = 0}</span>
                                            <p:outputLabel value="Choose nucleotide consensus: "/>
                                            <br/>
                                            <ui:repeat value="#{primerG3.getConsensosSeqs(seq)}" var="aminoSeq">
                                                <!--p:selectOneButton value="#{primerG3.nucleotidSeq[i][j]}"-->
                                                <p:selectOneButton>
                                                    <f:selectItems value="#{aminoSeq}" var="amino" itemLabel="#{amino}" itemValue="#{amino}"/>
                                                </p:selectOneButton>
                                                <span class="hidden">#{j = j + 1}</span>
                                            </ui:repeat>
                                            <h:form id="result-form" prependId="false">
                                                <p:commandButton value="Generate" actionListener="#{primerG3.getCodonSeq(primerG3.nucleotidSeq[i], i)}"/>
                                                <p:outputLabel id="resultNucleotid#{i}as" value="#{primerG3.resultNucleotidSeq[i]}"/>
                                            </h:form>
                                            <span class="hidden">#{i = i + 1}</span>
                                        </p:tab>    
                                    </p:accordionPanel>
                                    
                                </div>
                            </div>
                            <div>
                                <p:outputLabel styleClass="form-label" value="Secuencias alineadas" />
                                <span> <span class="glyphicon glyphicon-stop" aria-hidden="true"></span> Sitios conservados</span>
                                <div class="overflow">
                                    <table class="table table-hover">
                                        <ui:repeat value="#{primerG3.sequencesShow}" var="sequence">
                                            <tr>
                                                <ui:repeat value="#{sequence}" var="amino">
                                                    <td class="#{amino.sitioConservado ? 'sitio-conservado' : ''}">#{amino.seq}</td>
                                                </ui:repeat>
                                            </tr>
                                        </ui:repeat>
                                    </table>             
                                </div>                   
                            </div>

                        </p:panel>

                        <p:blockUI block="pnl" widgetVar="block">
                            <p id="loading">Cargando</p>
                            <p:graphicImage library="images" name="loader.gif"/>
                        </p:blockUI>
                    </h:form>                                   
                </div>

                <br />
                <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
            </h:body>
            <ui:include src="codonUsage.xhtml"/>

        </ui:define>

    </ui:composition>
</html>
